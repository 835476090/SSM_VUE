webpackJsonp([15],{U7uE:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var o={name:"goodslist",data:function(){return{pagenow:1,pagelimit:10,goodscount:0,goodsALLcount:0,pagesizes:[5,10,15,20],pagelist:[],selectgoods:[],resultgoods:[],goodsClassJO:{},resultAddress:[],nowclass:"全部",searchText:"",postjsonparam:{},dialogVisible:!1,btnText:"新建地址",editerIndex:0,isNewAddress:!1,selectAddress:"",newAddress:"",form:{"地址号":"","接收人":"","接收电话":"","收货地址":""}}},computed:{countMoney:function(){var t=0;for(var s in this.selectgoods){var e=this.selectgoods[s];t+=e.number*e.price}return t=t.toFixed(2)}},methods:{btnsearch:function(){var t=this;console.log(this.searchText),""==!this.searchText?this.$axios.get("http://localhost:8080/SSMWW/goodsSearch.do?searchText="+this.searchText).then(function(s){console.log(s.data),t.resultgoods=s.data,t.goodscount=s.data.length}):this.$message({message:"搜索内容不能为空",type:"warning"})},btnChange:function(){this.isNewAddress=!this.isNewAddress,this.btnText="选择地址"==this.btnText?"新建地址":"选择地址"},enterOrder:function(){var t=this;if(console.log("this.isNewAddress:"+this.isNewAddress),this.isNewAddress){var s=this.form,e=s.接收人,o=s.接收电话,a=s.收货地址,i={};i.receivename=e,i.receivephone=o,i.address=a,console.log(i),this.$axios.post("http://localhost:8080/SSMWW/addAddress.do",i).then(function(s){var e=s.data;console.log(e),"200"==e.code&&"添加成功"==e.msg?(t.$axios.get("http://localhost:8080/SSMWW/addressMaxId.do").then(function(s){console.log(s.data);var e=s.data;t.postjsonparam.addressid=e,t.submitOrder(),t.dialogVisible=!1}),t.$message({message:"恭喜你，添加成功",type:"success"})):t.$message({message:"不好意思，添加失败",type:"warning"})})}else{var n=this.selectAddress.split("|"),l=this.resultAddress[n[0]-1].addressid;this.postjsonparam.addressid=l,this.submitOrder(),this.dialogVisible=!1}},editAddress:function(){var t=this;this.form.地址号="",this.form.接收人="",this.form.接收电话="",this.form.收货地址="",this.resultAddress=[],this.dialogVisible=!0,this.$axios.get("http://localhost:8080/SSMWW/addressALL.do").then(function(s){console.log(s.data),t.resultAddress=s.data})},submitOrder:function(){var t=this;Date.prototype.format=function(t){var s={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var e in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),s)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?s[e]:("00"+s[e]).substr((""+s[e]).length)));return t},this.postjsonparam.confirmdate=(new Date).format("yyyy-MM-dd hh:mm:ss"),this.postjsonparam.countprice=this.countMoney;var s=localStorage.getItem("ms_username");this.$axios.get("http://localhost:8080/SSMWW/findSaleidBySaleName.do?salename="+s).then(function(s){t.postjsonparam.saleid=s.data,t.postjsonparam.orderdetails=t.selectgoods,t.$axios.get("http://localhost:8080/SSMWW/getToDayMaxOrderCode.do?date="+(new Date).format("yyyy-MM-dd")).then(function(s){var e=s.data;console.log("------------------------------------------------------------"),console.log(e);var o=void 0;o="200"==e.code?(new Date).format("yyyyMMdd")+(parseInt(e.maxordercode.substring(8))+1):o=(new Date).format("yyyyMMdd")+"1001",t.postjsonparam.ordercode=o,console.log(t.postjsonparam),t.$axios.post("http://localhost:8080/SSMWW/addGoodsOrder.do",t.postjsonparam).then(function(s){var e=s.data;console.log(e),"200"==e.code?(t.$message({message:"商品订单已提交成功",type:"success"}),t.selectgoods=[]):t.$message({message:"订单提交失败",type:"warning"})})})})},addToBasket:function(t,s,e,o){var a={goodsid:t,goodsname:s,price:e,index:o,number:1};if(this.selectgoods.length>0){var i=this.selectgoods.filter(function(t){return t.goodsname===s&&t.price===e});null!=i&&i.length>0?i[0].number++:this.selectgoods.push(a)}else this.selectgoods.push(a);this.selectgoods.push()},reduce:function(t){t.number--,t.number<1&&this.removeSelectGoods(t)},add:function(t){t.number++},handleSizeChange:function(t){console.log("每页 "+t+" 条"),this.pagelimit=t,console.log(this.nowclass+"----------------"),"全部"===this.nowclass?this.getGoodsAll():this.getGoodsByClass(this.nowclass)},handleCurrentChange:function(t){console.log("当前页: "+t),this.pagenow=t,"全部"===this.nowclass?this.getGoodsAll():this.getGoodsByClass(this.nowclass)},removeSelectGoods:function(t){this.selectgoods.splice(this.selectgoods.indexOf(t),1)},getGoodsAll:function(){var t=this;this.nowclass="全部",this.$axios.get("http://localhost:8080/SSMWW/goodsALLByPage.do?pageNow="+this.pagenow+"&pageLimit="+this.pagelimit).then(function(s){console.log(s.data),t.resultgoods=s.data,t.goodscount=t.goodsALLcount})},getGoodsByClass:function(t){var s=this;this.nowclass=t,console.log(t),this.$axios.get("http://localhost:8080/SSMWW/goodsByClassAndPage.do?goodsclass="+t+"&pageNow="+this.pagenow+"&pageLimit="+this.pagelimit).then(function(t){console.log(t.data),s.resultgoods=t.data,s.goodscount=s.resultgoods.length})}},created:function(){var t=this;this.$axios.get("http://localhost:8080/SSMWW/goodsCount.do?").then(function(s){t.goodsALLcount=s.data,t.goodscount=t.goodsALLcount}),this.$axios.get("http://localhost:8080/SSMWW/goodsClassALLMap.do").then(function(s){console.warn(s.data),t.goodsClassJO=s.data}),this.$axios.get("http://localhost:8080/SSMWW/goodsALLByPage.do?pageNow="+this.pagenow+"&pageLimit="+this.pagelimit).then(function(s){t.resultgoods=s.data,console.log(s.data)})}},a={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",[e("div",{staticClass:"row"},[e("div",{staticClass:"center offset-md-4"},[e("form",{staticClass:"input-group",on:{submit:function(s){return s.preventDefault(),t.btnsearch(s)}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],staticClass:"form-control",attrs:{type:"text",placeholder:"请输入要搜索的内容"},domProps:{value:t.searchText},on:{input:function(s){s.target.composing||(t.searchText=s.target.value)}}}),t._v(" "),e("input",{staticClass:"btn btn-outline-success",staticStyle:{"margin-left":"1px"},attrs:{type:"submit",value:"搜索"}})])])]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-lg-2"},[e("div",{staticClass:"list-group"},[e("button",{staticClass:"list-group-item list-group-item-action",on:{click:function(s){t.getGoodsAll()}}},[t._v("\n\t\t\t    全部\n\t\t\t    "),e("span",{staticClass:"badge badge-pill badge-success"},[t._v(t._s(t.goodsALLcount))])]),t._v(" "),t._l(t.goodsClassJO,function(s,o){return e("button",{staticClass:"list-group-item list-group-item-action",on:{click:function(s){t.getGoodsByClass(o)}}},[t._v("\n\t\t\t\t  "+t._s(o)),e("span",{staticClass:"badge badge-pill badge-success"},[t._v(t._s(s))])])})],2),t._v(" "),e("br")]),t._v(" "),e("div",{staticClass:"col-lg-6",staticStyle:{"background-color":"#fff"}},[e("table",{staticClass:"table"},[t._m(0),t._v(" "),e("tbody",t._l(t.resultgoods,function(s,o){return e("tr",[e("td",[t._v(t._s(s.goodsname))]),t._v(" "),e("td",[e("small",[e("i",[t._v(t._s(s.goodsid))])])]),t._v(" "),e("td",[t._v(t._s(s.price))]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-sm btn-outline-success",on:{click:function(e){t.addToBasket(s.goodsid,s.goodsname,s.price,o)}}},[t._v("+")])])])}))]),t._v(" "),e("div",{staticClass:"center offset-md-2"},[e("el-pagination",{attrs:{small:"","current-page":t.pagenow,"page-sizes":t.pagesizes,"page-size":t.pagelimit,layout:"total, sizes, prev, pager, next, jumper",total:t.goodscount},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)]),t._v(" "),e("div",{staticClass:"col-lg-4"},[t.selectgoods.length>0?e("div",{staticClass:"goodsbasket",staticStyle:{"background-color":"#fff"}},[e("table",{staticClass:"table"},[t._m(1),t._v(" "),e("tbody",t._l(t.selectgoods,function(s){return e("tr",[e("td",[e("button",{staticClass:"btn btn-sm btn-light",on:{click:function(e){t.reduce(s)}}},[t._v("-")]),t._v(" "),e("span",[t._v(t._s(s.number))]),t._v(" "),e("button",{staticClass:"btn btn-sm btn-light",on:{click:function(e){t.add(s)}}},[t._v("+")])]),t._v(" "),e("td",[t._v(t._s(s.goodsname))]),t._v(" "),e("td",[t._v(t._s(s.price))]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-sm btn-outline-danger",on:{click:function(e){t.removeSelectGoods(s)}}},[t._v("x")])])])}))]),t._v(" "),e("p",[t._v("总价:"+t._s(t.countMoney)+" RMB")]),t._v(" "),e("button",{staticClass:"btn btn-success btn-block",on:{click:t.editAddress}},[t._v("选择地址确认订单>>")])]):e("div",{staticClass:"basketText"},[t._v("\n\t\t\t\t购物车暂时没有商品\n\t\t\t")])]),t._v(" "),e("el-dialog",{attrs:{title:"选择地址",visible:t.dialogVisible},on:{"update:visible":function(s){t.dialogVisible=s}}},[e("form",[e("div",{staticClass:"form-group row"},[e("div",{staticClass:"input-group col-sm-12"},[e("el-button",{on:{click:t.btnChange}},[t._v(t._s(t.btnText))]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:t.selectAddress,expression:"selectAddress"},{name:"show",rawName:"v-show",value:!t.isNewAddress,expression:"!isNewAddress"}],staticClass:"custom-select col-sm-10",attrs:{id:"inlineFormCustomSelect"},on:{change:function(s){var e=Array.prototype.filter.call(s.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.selectAddress=s.target.multiple?e:e[0]}}},t._l(t.resultAddress,function(s,o){return e("option",[t._v("\n\n\t\t\t\t\t\t\t"+t._s(o+1)+" | "+t._s(s.receivename)+" | "+t._s(s.receivephone)+" | "+t._s(s.address)+"\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t")])}))],1)]),t._v(" "),t._l(t.form,function(s,o,a){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.isNewAddress,expression:"isNewAddress"}]},["地址号"!=o?e("div",{staticClass:"form-group row"},[e("label",{staticClass:"col-sm-2 offset-sm-1 col-form-label",attrs:{for:"aaa",disabled:"地址号"==o}},[t._v(t._s(o))]),t._v(" "),e("div",{staticClass:"col-sm-8"},[e("input",{directives:[{name:"model",rawName:"v-model:value",value:t.form[o],expression:"form[key]",arg:"value"}],staticClass:"form-control",attrs:{type:"text",id:"aaa"},domProps:{value:t.form[o]},on:{input:function(s){s.target.composing||t.$set(t.form,o,s.target.value)}}})])]):t._e()])})],2),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(s){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.enterOrder}},[t._v("确 定")])],1)])],1)])},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("thead",{staticClass:"thead-default"},[s("tr",[s("th",[this._v("商品名称")]),this._v(" "),s("th",[this._v("商品编号")]),this._v(" "),s("th",[this._v("价格")]),this._v(" "),s("th",[this._v("加入")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("thead",{staticClass:"thead-default"},[s("tr",[s("th",[this._v("数量")]),this._v(" "),s("th",[this._v("商品名称")]),this._v(" "),s("th",[this._v("价格")]),this._v(" "),s("th",[this._v("删除")])])])}]},i=e("C7Lr")(o,a,!1,null,null,null);s.default=i.exports}});